<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Gym-RPG Demo</title>
<style>
/* === RESET + MINI-FRAMEWORK ================================================= */
*,*:before,*:after{box-sizing:border-box;margin:0;padding:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
body{background:#1e1e2e;color:#e2e8f0;line-height:1.4;display:flex;min-height:100vh;flex-direction:column}
h1,h2{font-weight:700;margin:1rem 0 .5rem}
input,button,textarea,select{font:inherit;padding:.4rem .6rem;border-radius:6px;border:1px solid #555;background:#2a2a40;color:inherit}
button{cursor:pointer;border:none;background:#8b5cf6;color:#fff;font-weight:600}
button:hover{background:#7c3aed}
fieldset{border:1px solid #555;padding:1rem;border-radius:8px;margin:1rem 0}
progress{width:100%;height:1rem;border-radius:6px;background:#444}
progress::-webkit-progress-bar{background:#444}progress::-webkit-progress-value{background:#8b5cf6}
.flex{display:flex;align-items:center;gap:.75rem}
.mt{margin-top:1rem}
/* === LAYOUT ================================================================ */
#chat{flex:1;overflow-y:auto;background:#111827;padding:1rem;border-radius:8px}
.msg{margin:.5rem 0}.sys{color:#93c5fd}.user{color:#facc15}
.avatar{display:inline-block;background:#374151;border-radius:50%;width:64px;height:64px;text-align:center;line-height:64px;font-size:1.5rem;margin-right:.75rem}
.stat{display:inline-block;width:6rem}.stat b{float:right}
#arena img{width:96px;height:96px;border:2px solid #555;border-radius:8px}
/* === HIDDEN FILE INPUT ===================================================== */
#file{display:none}
label.upload{padding:.5rem;background:#4ade80;border:none;border-radius:6px;cursor:pointer;font-weight:600}
label.upload:hover{background:#22c55e}
</style>
</head>
<body>

<h1>üèãÔ∏è‚Äç‚ôÇÔ∏è Gym RPG Demo</h1>

<!-- AVATAR + STATS -->
<section class="flex">
  <span class="avatar" id="class">üó°Ô∏è</span>
  <div>
    <div><progress id="xpBar" max="100" value="0"></progress></div>
    <div class="stat">Fuerza<b id="str">5</b></div>
    <div class="stat">Energ√≠a<b id="eng">5</b></div>
    <div class="stat">Vitalidad<b id="vit">5</b></div>
    <div class="stat">Sabidur√≠a<b id="wis">5</b></div>
  </div>
</section>

<!-- INPUTS -->
<fieldset>
  <legend>Acci√≥n / Comida / Sue√±o</legend>
  <textarea id="txt" rows="3" placeholder="Describe tu actividad, comida o sue√±o‚Ä¶"></textarea>
  <div class="flex mt">
    <label class="upload">üì∏ Imagen
      <input type="file" id="file" accept="image/*">
    </label>
    <select id="classSel">
      <option value="üó°Ô∏è">Guerrero</option><option value="üèπ">Explorador</option>
      <option value="ü™Ñ">Mago</option><option value="üôè">Monje</option>
    </select>
    <button id="send">Enviar al Maestro</button>
  </div>
</fieldset>

<!-- CHAT -->
<article id="chat"></article>

<!-- ARENA -->
<section id="arena" class="flex mt" style="display:none">
  <img id="you"  src="https://i.imgur.com/FYypRdt.gif">
  <span id="vs" style="font-size:2rem">‚öîÔ∏è</span>
  <img id="foe"  src="https://i.imgur.com/X4Fq2Ef.gif">
</section>

<script>
/* ========= ESTADO ========================================================= */
const state={
  str:5,eng:5,vit:5,wis:5,xp:0,level:1,cls:"üó°Ô∏è"
};
function updStats(d){              // d = {str:+1,vit:-2,xp:+10‚Ä¶}
  Object.entries(d).forEach(([k,v])=>{
    state[k]=(state[k]??0)+v;
  });
  if(state.xp>=100){state.level++;state.xp-=100;log("sys",`¬°Subes a nivel ${state.level}!`)}
  draw();
}
function draw(){
  xpBar.value=state.xp;
  str.textContent=state.str;
  eng.textContent=state.eng;
  vit.textContent=state.vit;
  wis.textContent=state.wis;
  class.textContent=state.cls;
}
/* ========= CHAT LOG ======================================================= */
function log(who,txt){
  const div=document.createElement("div");div.className=`msg ${who}`;div.textContent=txt;
  chat.appendChild(div);chat.scrollTop=chat.scrollHeight;
}
/* ========= GEMINI MOCK ==================================================== */
async function callGeminiMock(prompt,imgB64){
  await new Promise(r=>setTimeout(r,800));          // simula latencia
  // Valoraci√≥n muy simplificada:
  if(imgB64){                                       // si hay foto la tratamos como comida sana
    return {delta:{vit:7,xp:10},msg:"¬°Deliciosa comida saludable! +7 Vitalidad +10 XP"};
  }
  if(/flexiones|sentadillas|correr|cardio|entreno/i.test(prompt)){
    const reps = (prompt.match(/\d+/)||[10])[0]*1;
    return {delta:{str:reps,xp:5},msg:`Detecto ejercicio: +${reps} Fuerza +5 XP`};
  }
  if(/dorm[i√≠]|\bhora/i.test(prompt)){
    const h = (prompt.match(/\d+(?:[.,]\d+)?/)||[7])[0]*1;
    return {delta:{eng:h,xp:3},msg:`Descanso de ${h}h ‚Üí +${h} Energ√≠a +3 XP`};
  }
  return {delta:{wis:1,xp:1},msg:"Constancia registrada ‚Üí +1 Sabidur√≠a +1 XP"};
}
/* ========= ENV√çO ========================================================== */
send.onclick=async()=>{
  const txt=txt.value.trim();const file=fileInput.files[0];
  if(!txt && !file){alert("Escribe algo o sube una foto");return;}
  log("user",txt||"[Imagen]");
  // codificar imagen
  let imgB64=null;
  if(file){
    const b=await file.arrayBuffer();
    imgB64=btoa(String.fromCharCode(...new Uint8Array(b)));
  }
  // ‚ÄúGemini‚Äù
  const {delta,msg}=await callGeminiMock(txt,imgB64);
  updStats(delta);
  log("sys",msg);
  // peque√±o % chance de combate
  if(Math.random()<0.3) launchBattle();
  txt.value="";fileInput.value="";
};
const fileInput=document.getElementById("file");
/* ========= CAMBIO CLASE =================================================== */
classSel.onchange=()=>{state.cls=classSel.value;draw();};
/* ========= MINI-ARENA ===================================================== */
function launchBattle(){
  arena.style.display="flex";
  log("sys","¬°Un rival aparece!");
  const powerYou = state.str+state.vit+Math.random()*5;
  const powerFoe = state.level*10+Math.random()*8;
  setTimeout(()=>{
    if(powerYou>powerFoe){
      log("sys","üèÜ Ganaste el combate ‚Üí +10 XP");
      updStats({xp:10});
      vs.textContent="üèÜ";
    }else{
      log("sys","üíÄ Derrota‚Ä¶ Pierdes 2 Vitalidad");
      updStats({vit:-2});
      vs.textContent="üíÄ";
    }
    setTimeout(()=>arena.style.display="none",2500);
  },1500);
}
/* ========= START ========================================================== */
draw();
log("sys","¬°Bienvenido aventurero! El Maestro aguarda tus logros.");
</script>
</body>
</html>
